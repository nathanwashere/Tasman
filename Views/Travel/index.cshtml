@using Tasman.Models
@model IEnumerable<Travel>
@{
    Layout = "~/Views/Shared/TravelLayout.cshtml";
}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
<link rel="stylesheet" href="~/css/travel.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />

<div class="main">
    <div class="page-container">
        <section class="hero-card">
            <div class="hero-text">
                <p class="eyebrow">Curated escapes</p>
                <h1>Your next adventure awaits</h1>
                <p>Hand-picked packages with the Tasman aesthetic—bold color, smooth motion, luxe details, and easy booking.</p>
                <div class="hero-actions">
                    <a href="#packages" class="pill primary">Browse all trips</a>
                    <a href="/Login" class="pill ghost">Sign in</a>
                </div>
            </div>
            <div class="hero-badge">
                <span class="price-tag">₪2,500+</span>
                <p>starting at</p>
            </div>
        </section>

        <div class="Header">

            <div class="date-filter-container filter-group">
                <label for="startDate"><i class="fas fa-calendar-alt"></i> Start Date:</label>
                <input type="text"
                        id="startDate"
                        placeholder="Select Date"
                        value="@ViewBag.StartDate" />
            </div>

            <div class="search-container filter-group">
                <label for="search">Destination Search:</label>
                <input type="text"
                        id="search"
                        placeholder="Search destinations..."
                        value="@ViewBag.Search" />
            </div>

            <div class="filter-container filter-group">
                <label for="PackageType">Package Type:</label>
                <select id="PackageType">

                    @if (ViewBag.PackageType == null)
                    {
                        <option value="" selected disabled hidden>Category</option>
                    }
                    else
                    {
                        <option value="" disabled hidden>Category</option>
                    }
                    <option value="">All Categories</option>

                    @if (ViewBag.PackageType == "luxury")
                    {
                        <option value="luxury" selected>Luxury</option>
                    }
                    else { <option value="luxury">Luxury</option> }

                    @if (ViewBag.PackageType == "honeymoon")
                    {
                        <option value="honeymoon" selected>Honeymoon</option>
                    }
                    else { <option value="honeymoon">Honeymoon</option> }

                    @if (ViewBag.PackageType == "family")
                    {
                        <option value="family" selected>Family</option>
                    }
                    else { <option value="family">Family</option> }

                    @if (ViewBag.PackageType == "adventure")
                    {
                        <option value="adventure" selected>Adventure</option>
                    }
                    else { <option value="adventure">Adventure</option> }

                    @if (ViewBag.PackageType == "city")
                    {
                        <option value="city" selected>City</option>
                    }
                    else { <option value="city">City</option> }

                    @if (ViewBag.PackageType == "wellness")
                    {
                        <option value="wellness" selected>Wellness</option>
                    }
                    else { <option value="wellness">Wellness</option> }

                    @if (ViewBag.PackageType == "heritage")
                    {
                        <option value="heritage" selected>Heritage</option>
                    }
                    else { <option value="heritage">Heritage</option> }
                </select>
            </div>

            <div class="filter-container filter-group">
                <label for="sort">Sorting Options:</label>
                <select id="sort">

                    @if (ViewBag.Sort == null)
                    {
                        <option value="" selected disabled hidden>Sort By...</option>
                    }
                    else
                    {
                        <option value="" disabled hidden>Sort By...</option>
                    }
                    <option value="">Default</option>

                    @if (ViewBag.Sort == "price-asc")
                    {
                        <option value="price-asc" selected>Price Low → High</option>
                    }
                    else { <option value="price-asc">Price Low → High</option> }

                    @if (ViewBag.Sort == "price-desc")
                    {
                        <option value="price-desc" selected>Price High → Low</option>
                    }
                    else { <option value="price-desc">Price High → Low</option> }
                </select>
            </div>

            <div class="price-range-container filter-group">
                <label for="maxPrice"><i class="fas fa-wallet"></i> Max Price:</label>
                <div class="range-wrapper">
                    <input type="range"
                            id="maxPrice"
                            min="0"
                            max="20000"
                            step="500"
                            value="@(ViewBag.MaxPrice ?? 20000)" />

                    <span id="range-value">₪@((int)(ViewBag.MaxPrice ?? 20000))</span>
                </div>
            </div>

            <div class="filter-container filter-group">
                <label for="discounted"><i class="fas fa-percentage"></i> Discounts</label>
                <div class="toggle-wrap">
                    <input type="checkbox" id="discounted" @(ViewBag.Discounted == true ? "checked" : "") />
                    <span class="toggle-label">Show discounted only</span>
                </div>
            </div>

        </div>

        <p class="page-title recommended-title">Our Top Recommendations</p>
        <div class="swiper main-swiper">
            <div class="swiper-wrapper">

                @foreach (var t in Model.Take(6)) // Only show a few for the "recommended" swiper
                {
                    <div class="swiper-slide travel-card">
                        <div class="travel-image-wrapper">
                            <div class="travel-image"
                                    style="background-image:url('@t.ImageUrl');">
                            </div>
                            <span class="travel-PackageType">@t.PackageType</span>
                        </div>
                        
                        <div class="card-content">
                            <p class="travel-country">@t.Country</p> 
                            <p class="travel-title">@t.Destination</p> 
                            
                            @if (t.DiscountPrice.HasValue && t.DiscountEndsAt.HasValue && t.DiscountEndsAt.Value > DateTime.UtcNow)
                            {
                                <p class="travel-price"><span class="old-price">₪@t.Price</span> ₪@t.DiscountPrice</p>
                            }
                            else
                            {
                                <p class="travel-price">₪@t.Price</p>
                            }
                            <div class="card-actions">
                                <a href="/Travel/Details/@t.Id" class="book-now-btn">Book</a>
                                <a href="#" class="buy-now-btn">Buy Now</a> </div>
                        </div>
                    </div>
                }

            </div>

            <div class="swiper-pagination"></div>
        </div>

        <p class="page-title all-packages-title" id="packages">All Available Packages</p>
        <div class="travel-grid">

            @foreach (var t in Model)
            {
                <div class="travel-card grid-item">
                    <div class="travel-image-wrapper">
                        <div class="travel-image"
                                style="background-image:url('@t.ImageUrl');">
                        </div>
                        <span class="travel-PackageType">@t.PackageType</span>
                    </div>
                    
                    <div class="card-content">
                        <p class="travel-country">@t.Country</p>
                        <p class="travel-title">@t.Destination</p>
                        @if (t.DiscountPrice.HasValue && t.DiscountEndsAt.HasValue && t.DiscountEndsAt.Value > DateTime.UtcNow)
                        {
                            <p class="travel-price"><span class="old-price">₪@t.Price</span> ₪@t.DiscountPrice</p>
                        }
                        else
                        {
                            <p class="travel-price">₪@t.Price</p>
                        }
                        <div class="card-actions">
                            <a href="/Travel/Details/@t.Id" class="book-now-btn">Book</a>
                            <a href="#" class="buy-now-btn">Buy Now</a> </div>
                    </div>
                </div>
            }

        </div>

    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

<script>
    // FLATPICKR (dd/mm/yyyy)
    flatpickr("#startDate", {
        dateFormat: "d/m/Y",
        allowInput: true,
        disableMobile: true
    });

    // SWIPER
    new Swiper(".main-swiper", {
        slidesPerView: 'auto',
        spaceBetween: 25, 
        centeredSlides: false,
        pagination: { el: ".swiper-pagination", clickable: true }
    });

    // PRICE LABEL LIVE UPDATE
    document.getElementById("maxPrice").addEventListener("input", function () {
        document.getElementById("range-value").textContent = `₪${this.value}`;
    });

    // FILTER APPLY
    function applyFilters() {
        const search = document.getElementById("search").value;
        const packageType = document.getElementById("PackageType").value;
        const sort = document.getElementById("sort").value;
        const maxPrice = document.getElementById("maxPrice").value;
        const startDate = document.getElementById("startDate").value;
        const discounted = document.getElementById("discounted").checked;

        window.location.href =
            `/Travel?search=${search}&PackageType=${packageType}&sort=${sort}&maxPrice=${maxPrice}&startDate=${startDate}&discounted=${discounted}`;
    }

    document.getElementById("PackageType").addEventListener("change", applyFilters);
    document.getElementById("sort").addEventListener("change", applyFilters);
    document.getElementById("maxPrice").addEventListener("change", applyFilters);
    document.getElementById("startDate").addEventListener("change", applyFilters);
    document.getElementById("discounted").addEventListener("change", applyFilters);

    document.getElementById("search").addEventListener("keypress", e => {
        if (e.key === "Enter") applyFilters();
    });
</script>
