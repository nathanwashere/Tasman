@using Tasman.Models
@model IEnumerable<Travel>
@{
    Layout = "~/Views/Shared/TravelLayout.cshtml";
}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
<link rel="stylesheet" href="~/css/travel.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />

<div class="main">
    <div class="page-container">
        
        <h1 class="main-heading">Your Next Adventure Awaits</h1>
        <p class="sub-heading">Discover hand-picked travel packages for every dream.</p>
        
        <div class="Header">

            <div class="date-filter-container filter-group">
                <label for="startDate"><i class="fas fa-calendar-alt"></i> Start Date:</label>
                <input type="text"
                        id="startDate"
                        placeholder="Select Date"
                        value="@ViewBag.StartDate" />
            </div>

            <div class="search-container filter-group">
                <label for="search">Destination Search:</label>
                <input type="text"
                        id="search"
                        placeholder="Search destinations..."
                        value="@ViewBag.Search" />
            </div>

            <div class="filter-container filter-group">
                <label for="PackageType">Package Type:</label>
                <select id="PackageType">

                    @if (ViewBag.PackageType == null)
                    {
                        <option value="" selected disabled hidden>Category</option>
                    }
                    else
                    {
                        <option value="" disabled hidden>Category</option>
                    }
                    <option value="">All Categories</option>

                    @if (ViewBag.PackageType == "luxury")
                    {
                        <option value="luxury" selected>Luxury</option>
                    }
                    else { <option value="luxury">Luxury</option> }

                    @if (ViewBag.PackageType == "honeymoon")
                    {
                        <option value="honeymoon" selected>Honeymoon</option>
                    }
                    else { <option value="honeymoon">Honeymoon</option> }

                    @if (ViewBag.PackageType == "family")
                    {
                        <option value="family" selected>Family</option>
                    }
                    else { <option value="family">Family</option> }

                    @if (ViewBag.PackageType == "adventure")
                    {
                        <option value="adventure" selected>Adventure</option>
                    }
                    else { <option value="adventure">Adventure</option> }

                </select>
            </div>

            <div class="filter-container filter-group">
                <label for="sort">Sorting Options:</label>
                <select id="sort">

                    @if (ViewBag.Sort == null)
                    {
                        <option value="" selected disabled hidden>Sort By...</option>
                    }
                    else
                    {
                        <option value="" disabled hidden>Sort By...</option>
                    }
                    <option value="">Default</option>

                    @if (ViewBag.Sort == "price-asc")
                    {
                        <option value="price-asc" selected>Price Low â†’ High</option>
                    }
                    else { <option value="price-asc">Price Low â†’ High</option> }

                    @if (ViewBag.Sort == "price-desc")
                    {
                        <option value="price-desc" selected>Price High â†’ Low</option>
                    }
                    else { <option value="price-desc">Price High â†’ Low</option> }
                </select>
            </div>

            <div class="price-range-container filter-group">
                <label for="maxPrice"><i class="fas fa-wallet"></i> Max Price:</label>
                <div class="range-wrapper">
                    <input type="range"
                            id="maxPrice"
                            min="0"
                            max="20000"
                            step="500"
                            value="@(ViewBag.MaxPrice ?? 0)" />

                    <span id="range-value">â‚ª@((int)(ViewBag.MaxPrice ?? 0))</span>
                </div>
            </div>

        </div>

        <p class="page-title recommended-title">ðŸ”¥ Our Top Recommendations</p>
        <div class="swiper main-swiper">
            <div class="swiper-wrapper">

                @foreach (var t in Model.Take(6)) // Only show a few for the "recommended" swiper
                {
                    <div class="swiper-slide travel-card">
                        <div class="travel-image-wrapper">
                            <div class="travel-image"
                                    style="background-image:url('@t.ImageUrl');">
                            </div>
                            <span class="travel-PackageType">@t.PackageType</span>
                        </div>
                        
                        <div class="card-content">
                            @* ðŸ’¡ NEW CODE: Display Destination Country and Package Title *@
                            <p class="travel-country">@t.Country</p> 
                            <p class="travel-title">@t.Destination</p> 
                            
                            <p class="travel-price">â‚ª@t.Price</p>
                            <div class="card-actions">
                                <a href="/Travel/Details/@t.Id" class="book-now-btn">Book</a>
                                <a href="#" class="buy-now-btn">Buy Now</a> </div>
                        </div>
                    </div>
                }

            </div>

            <div class="swiper-pagination"></div>
        </div>

        <p class="page-title all-packages-title">All Available Packages</p>
        <div class="travel-grid">

            @foreach (var t in Model)
            {
                <div class="travel-card grid-item">
                    <div class="travel-image-wrapper">
                        <div class="travel-image"
                                style="background-image:url('@t.ImageUrl');">
                        </div>
                        <span class="travel-PackageType">@t.PackageType</span>
                    </div>
                    
                    <div class="card-content">
                        <p class="travel-country">@t.Country</p>
                        <p class="travel-title">@t.Destination</p>
                        <p class="travel-price">â‚ª@t.Price</p>
                        <div class="card-actions">
                            <a href="/Travel/Details/@t.Id" class="book-now-btn">Book</a>
                            <a href="#" class="buy-now-btn">Buy Now</a> </div>
                    </div>
                </div>
            }

        </div>

    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

<script>
    // FLATPICKR (dd/mm/yyyy)
    flatpickr("#startDate", {
        dateFormat: "d/m/Y",
        allowInput: true,
        disableMobile: true
    });

    // SWIPER
    new Swiper(".main-swiper", {
        slidesPerView: 'auto',
        spaceBetween: 25, 
        centeredSlides: false, // Keep false for regular scrolling (or set true if you want the "peek" effect)
        pagination: { el: ".swiper-pagination", clickable: true }
    });

    // PRICE LABEL LIVE UPDATE (No functionality change)
    document.getElementById("maxPrice").addEventListener("input", function () {
        document.getElementById("range-value").textContent = `â‚ª${this.value}`;
    });

    // FILTER APPLY (No functionality change)
    function applyFilters() {
        const search = document.getElementById("search").value;
        const packageType = document.getElementById("PackageType").value;
        const sort = document.getElementById("sort").value;
        const maxPrice = document.getElementById("maxPrice").value;
        const startDate = document.getElementById("startDate").value;

        // Note: The logic here is still correct for applying filters to the entire page view
        window.location.href =
            `/Travel?search=${search}&PackageType=${packageType}&sort=${sort}&maxPrice=${maxPrice}&startDate=${startDate}`;
    }

    document.getElementById("PackageType").addEventListener("change", applyFilters);
    document.getElementById("sort").addEventListener("change", applyFilters);
    document.getElementById("maxPrice").addEventListener("change", applyFilters);
    document.getElementById("startDate").addEventListener("change", applyFilters);

    document.getElementById("search").addEventListener("keypress", e => {
        if (e.key === "Enter") applyFilters();
    });
</script>