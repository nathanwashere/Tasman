@model Tasman.Models.Booking
@{
    Layout = "~/Views/Shared/TravelLayout.cshtml";
    var user = ViewBag.User as Tasman.Models.User;
    var message = ViewBag.Message as string;
    var addedToCart = ViewBag.AddedToCart as bool? ?? false;
}

<link rel="stylesheet" href="~/css/travel.css" />

<div class="main">
    <div class="page-container">
        <section class="hero-card">
            <div class="hero-text">
                <p class="eyebrow">Checkout</p>
                <h1>Confirm your trip</h1>
                <p>We'll use your contact info from your profile. Card data is not stored.</p>
                @if (!string.IsNullOrEmpty(message))
                {
                    <div class="pill" style="background:rgba(64,145,108,0.12);color:#40916c;">@message</div>
                }
            </div>
            <div class="hero-badge">
                <span class="price-tag">$@Model.TotalPrice</span>
                <p>Total</p>
            </div>
        </section>

        <div class="travel-card" style="max-width:820px;margin:18px auto;">
            <div class="travel-image-wrapper">
                <div class="travel-image" style="background-image:url('@Model.Travel?.ImageUrl');height:220px;"></div>
                <span class="travel-PackageType">@Model.Travel?.PackageType</span>
            </div>
            <div class="card-content">
                <p class="travel-country">@Model.Travel?.Country</p>
                <p class="travel-title">@Model.Travel?.Destination</p>
                <p class="travel-price">Rooms: @Model.Rooms | Total: $@Model.TotalPrice</p>
            </div>
        </div>

        <form asp-action="Checkout" method="post" class="auth-form" style="max-width:820px;margin:18px auto;background:#fff;padding:22px;border-radius:14px;box-shadow:0 14px 40px rgba(0,0,0,0.08);">
            <input type="hidden" name="id" value="@Model.Id" />
            <div asp-validation-summary="ModelOnly" class="text-danger" style="margin-bottom:8px;"></div>
            <div class="form-grid" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:14px;">
                <div class="form-group">
                    <label>Full Name</label>
                    <input name="cardHolder" class="form-control" value="@(user?.FirstName + " " + user?.LastName)" required />
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input name="email" type="email" class="form-control" value="@user?.Email" required />
                </div>
                <div class="form-group">
                    <label>Phone</label>
                    <input name="phone" class="form-control" value="@user?.PhoneNumber" />
                </div>
                <div class="form-group">
                    <label>Card Number</label>
                    <input name="cardNumber" class="form-control" placeholder="0000 0000 0000 0000" required />
                </div>
                <div class="form-group">
                    <label>Expiry</label>
                    <input name="expiry" class="form-control" placeholder="MM/YY" required />
                </div>
                <div class="form-group">
                    <label>CVV</label>
                    <input name="cvv" class="form-control" placeholder="123" required />
                </div>
            </div>
            <div class="form-actions" style="margin-top:16px;">
                <button type="submit" class="book-now-btn" style="width:100%;text-align:center;">Confirm checkout</button>
            </div>
            <p class="muted" style="margin-top:10px;">A PDF receipt will be ready after confirmation. Email delivery is coming soon.</p>
        </form>
    </div>
</div>

@if (addedToCart)
{
    <div id="addedToCartModal" style="position:fixed;inset:0;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center;z-index:9999;">
        <div style="background:white;padding:22px 24px;border-radius:14px;max-width:360px;width:92%;box-shadow:0 12px 30px rgba(0,0,0,0.18);text-align:center;">
            <p class="eyebrow">Added to cart</p>
            <h2 style="margin:6px 0 10px;">Booking saved</h2>
            <p class="muted">Your booking is in the cart. You can review details or pay now.</p>
            <div style="display:flex;gap:10px;justify-content:center;margin-top:16px;flex-wrap:wrap;">
                <a class="book-now-btn" href="/Cart">Go to cart</a>
                <button class="buy-now-btn" type="button" onclick="document.getElementById('addedToCartModal').remove();">Stay here</button>
            </div>
        </div>
    </div>
}
